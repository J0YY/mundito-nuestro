"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[18],{7018:function(e,t,n){n.r(t),n.d(t,{default:function(){return A}});var l,r,a=n(7437),o=n(2265);function s(e,t){return Object.freeze({...e,...t})}let i=(0,o.createContext)(null),c=i.Provider;function u(){let e=(0,o.useContext)(i);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}function d(){return u().map}function m(e){let t=d();return(0,o.useEffect)(function(){return t.on(e),function(){t.off(e)}},[t,e]),t}var p=n(7691),f=n.n(p);function x(){return(x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(e[l]=n[l])}return e}).apply(this,arguments)}let h=(0,o.forwardRef)(function({bounds:e,boundsOptions:t,center:n,children:l,className:r,id:a,placeholder:s,style:i,whenReady:u,zoom:d,...m},f){let[h]=(0,o.useState)({className:r,id:a,style:i}),[v,g]=(0,o.useState)(null);(0,o.useImperativeHandle)(f,()=>v?.map??null,[v]);let b=(0,o.useCallback)(l=>{if(null!==l&&null===v){let r=new p.Map(l,m);null!=n&&null!=d?r.setView(n,d):null!=e&&r.fitBounds(e,t),null!=u&&r.whenReady(u),g(Object.freeze({__version:1,map:r}))}},[]);(0,o.useEffect)(()=>()=>{v?.map.remove()},[v]);let j=v?o.createElement(c,{value:v},l):s??null;return o.createElement("div",x({},h,{ref:b}),j)});var v=n(4887);function g(e,t,n){return Object.freeze({instance:e,context:t,container:n})}function b(e,t){return null==t?function(t,n){let l=(0,o.useRef)();return l.current||(l.current=e(t,n)),l}:function(n,l){let r=(0,o.useRef)();r.current||(r.current=e(n,l));let a=(0,o.useRef)(n),{instance:s}=r.current;return(0,o.useEffect)(function(){a.current!==n&&(t(s,n,a.current),a.current=n)},[s,n,l]),r}}function j(e,t){let n=(0,o.useRef)(t);(0,o.useEffect)(function(){t!==n.current&&null!=e.attributionControl&&(null!=n.current&&e.attributionControl.removeAttribution(n.current),null!=t&&e.attributionControl.addAttribution(t)),n.current=t},[e,t])}function y(e,t){let n=(0,o.useRef)();(0,o.useEffect)(function(){return null!=t&&e.instance.on(t),n.current=t,function(){null!=n.current&&e.instance.off(n.current),n.current=null}},[e,t])}function w(e,t){let n=e.pane??t.pane;return n?{...e,pane:n}:e}function N(e,t){(0,o.useEffect)(function(){return(t.layerContainer??t.map).addLayer(e.instance),function(){t.layerContainer?.removeLayer(e.instance),t.map.removeLayer(e.instance)}},[t,e])}function C(e,t){var n,l;return n=b(e),l=function(e,l){let r=u(),a=n(w(e,r),r);return j(r.map,e.attribution),y(a.current,e.eventHandlers),t(a.current,r,e,l),a},(0,o.forwardRef)(function(e,t){let[n,r]=(0,o.useState)(!1),{instance:a}=l(e,r).current;(0,o.useImperativeHandle)(t,()=>a),(0,o.useEffect)(function(){n&&a.update()},[a,n,e.children]);let s=a._contentNode;return s?(0,v.createPortal)(e.children,s):null})}function k(e,t){var n,l;return n=b(e,t),l=function(e){let t=u(),l=n(w(e,t),t);return y(l.current,e.eventHandlers),N(l.current,t),function(e,t){let n=(0,o.useRef)();(0,o.useEffect)(function(){if(t.pathOptions!==n.current){let l=t.pathOptions??{};e.instance.setStyle(l),n.current=l}},[e,t])}(l.current,e),l},(0,o.forwardRef)(function(e,t){let{instance:n,context:r}=l(e).current;return(0,o.useImperativeHandle)(t,()=>n),null==e.children?null:o.createElement(c,{value:r},e.children)})}let _=(l=b(function({url:e,...t},n){return g(new p.TileLayer(e,w(t,n)),n)},function(e,t,n){!function(e,t,n){let{opacity:l,zIndex:r}=t;null!=l&&l!==n.opacity&&e.setOpacity(l),null!=r&&r!==n.zIndex&&e.setZIndex(r)}(e,t,n);let{url:l}=t;null!=l&&l!==n.url&&e.setUrl(l)}),r=function(e){let t=u(),n=l(w(e,t),t);return j(t.map,e.attribution),y(n.current,e.eventHandlers),N(n.current,t),n},(0,o.forwardRef)(function(e,t){let{instance:n}=r(e).current;return(0,o.useImperativeHandle)(t,()=>n),null})),S=k(function({center:e,children:t,...n},l){let r=new p.CircleMarker(e,n);return g(r,s(l,{overlayContainer:r}))},function(e,t,n){t.center!==n.center&&e.setLatLng(t.center),null!=t.radius&&t.radius!==n.radius&&e.setRadius(t.radius)}),E=C(function(e,t){return g(new p.Tooltip(e,t.overlayContainer),t)},function(e,t,{position:n},l){(0,o.useEffect)(function(){let r=t.overlayContainer;if(null==r)return;let{instance:a}=e,o=e=>{e.tooltip===a&&(null!=n&&a.setLatLng(n),a.update(),l(!0))},s=e=>{e.tooltip===a&&l(!1)};return r.on({tooltipopen:o,tooltipclose:s}),r.bindTooltip(a),function(){r.off({tooltipopen:o,tooltipclose:s}),null!=r._map&&r.unbindTooltip()}},[e,t,l,n])}),L=C(function(e,t){return g(new p.Popup(e,t.overlayContainer),t)},function(e,t,{position:n},l){(0,o.useEffect)(function(){let{instance:r}=e;function a(e){e.popup===r&&(r.update(),l(!0))}function o(e){e.popup===r&&l(!1)}return t.map.on({popupopen:a,popupclose:o}),null==t.overlayContainer?(null!=n&&r.setLatLng(n),r.openOn(t.map)):t.overlayContainer.bindPopup(r),function(){t.map.off({popupopen:a,popupclose:o}),t.overlayContainer?.unbindPopup(),t.map.removeLayer(r)}},[e,t,l,n])}),D=k(function({positions:e,...t},n){let l=new p.Polyline(e,t);return g(l,s(n,{overlayContainer:l}))},function(e,t,n){t.positions!==n.positions&&e.setLatLngs(t.positions)});var T=n(6792),z=n(2752),R=n(1180);let O=["core","thought","bucket_list","trip","milestone","inside_joke","celebration","heartbreak_repair","anniversary","secret"],M=["soft","romantic","chaotic","longing","nostalgic"];function P(e){var t,n,l,r,s;let{open:i,onClose:c,initialLatLng:u,editing:d}=e,{addMemory:m,updateMemory:p}=(0,z.q)(),[f,x]=(0,o.useState)((null==d?void 0:d.title)||""),[h,g]=(0,o.useState)((null==d?void 0:d.description)||""),[b,j]=(0,o.useState)((null==d?void 0:d.contributor)||"joy"),[y,w]=(0,o.useState)((null==d?void 0:d.category)||"core"),[N,C]=(0,o.useState)((null==d?void 0:d.mood)||""),[k,_]=(0,o.useState)((null==d?void 0:d.emoji)||""),[S,E]=(0,o.useState)((null==d?void 0:d.date)||""),[L,D]=(0,o.useState)((null==d?void 0:null===(t=d.time)||void 0===t?void 0:t.slice(0,5))||""),[P,F]=(0,o.useState)((null==d?void 0:d.secret_unlock_date)||""),[q,I]=(0,o.useState)(null),[B,H]=(0,o.useState)(!1),[U,Z]=(0,o.useState)(null),G=null!==(l=null!==(n=null==d?void 0:d.lat)&&void 0!==n?n:null==u?void 0:u.lat)&&void 0!==l?l:0,A=null!==(s=null!==(r=null==d?void 0:d.lng)&&void 0!==r?r:null==u?void 0:u.lng)&&void 0!==s?s:0,V=f&&h&&S,J=(0,o.useMemo)(()=>T.pG[y],[y]);if(!i)return null;let X=async()=>{if(!q)return(null==d?void 0:d.photo_url)||null;let e="memory-photos/".concat(crypto.randomUUID(),"-").concat(q.name),{error:t}=await R.O.storage.from("memory-photos").upload(e,q,{cacheControl:"3600",upsert:!1});if(t)return Z(t.message),(null==d?void 0:d.photo_url)||null;let{data:n}=R.O.storage.from("memory-photos").getPublicUrl(e);return n.publicUrl},Y=async e=>{if(e.preventDefault(),V){H(!0),Z(null);try{let e=await X();if(d)await p(d.id,{title:f,description:h,contributor:b,category:y,mood:N||null,emoji:k||null,date:S,time:L?"".concat(L,":00"):null,photo_url:e,secret_unlock_date:"secret"===y&&P||null,color:T.pG[y]});else{let t={lat:G,lng:A,title:f,description:h,contributor:b,category:y,mood:N||null,emoji:k||null,date:S,time:L?"".concat(L,":00"):null,photo_url:e,secret_unlock_date:"secret"===y&&P||null,color:T.pG[y],is_bucket_list_completed:!1};await m(t)}c()}finally{H(!1)}}};return(0,v.createPortal)((0,a.jsx)("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-black/50 p-3 animate-fade",children:(0,a.jsxs)("div",{className:"w-full max-w-lg romantic-card p-4 max-h-[85vh] overflow-auto shadow-2xl animate-pop",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:d?"Edit Memory":"Create Memory"}),(0,a.jsx)("button",{className:"text-slate-500 hover:text-slate-800",onClick:c,children:"Close"})]}),U?(0,a.jsx)("div",{className:"text-sm text-rose-600 mb-2",children:U}):null,(0,a.jsxs)("form",{className:"space-y-3",onSubmit:Y,children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"Title"}),(0,a.jsx)("input",{className:"input",value:f,onChange:e=>x(e.target.value),required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"Contributor"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("input",{type:"radio",name:"contrib",checked:"joy"===b,onChange:()=>j("joy")}),"Joy"]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("input",{type:"radio",name:"contrib",checked:"socrates"===b,onChange:()=>j("socrates")}),"Socrates"]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"Description"}),(0,a.jsx)("textarea",{className:"textarea",rows:4,value:h,onChange:e=>g(e.target.value),required:!0})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"Category"}),(0,a.jsx)("select",{className:"select",value:y,onChange:e=>w(e.target.value),children:O.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"Mood"}),(0,a.jsxs)("select",{className:"select",value:N,onChange:e=>C(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"(optional)"}),M.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"Emoji"}),(0,a.jsx)("input",{className:"input",value:k,onChange:e=>_(e.target.value),placeholder:"\uD83E\uDDF8"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"Date"}),(0,a.jsx)("input",{type:"date",className:"input",value:S,onChange:e=>E(e.target.value),required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"Time"}),(0,a.jsx)("input",{type:"time",className:"input",value:L,onChange:e=>D(e.target.value)})]})]}),"secret"===y?(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"Secret unlock date (optional)"}),(0,a.jsx)("input",{type:"date",className:"input",value:P,onChange:e=>F(e.target.value)})]}):null,(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"Photo"}),(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t,n;return I(null!==(n=null===(t=e.target.files)||void 0===t?void 0:t[0])&&void 0!==n?n:null)}})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded-full",style:{background:J}}),(0,a.jsx)("span",{className:"text-xs text-slate-500",children:"Pin color by category"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{type:"button",className:"btn-soft",onClick:c,children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:!V||B,className:"btn-brand disabled:opacity-50",children:d?"Save Changes":"Save Memory"})]})]})]})]})}),document.body)}function F(e){let{checked:t,onChange:n}=e;return(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("input",{type:"checkbox",checked:t,onChange:e=>n(e.target.checked)}),"We did this!",t?(0,a.jsx)("span",{className:"ml-1",children:"✨"}):null]})}function q(e){var t;let{memory:n,onEdit:l}=e,{updateMemory:r,deleteMemory:o}=(0,z.q)(),s="secret"===n.category&&null!==n.secret_unlock_date&&new Date(n.secret_unlock_date)>new Date,i=(0,a.jsx)("span",{className:"inline-flex items-center justify-center w-6 h-6 rounded-full text-xs font-semibold shadow ".concat("joy"===n.contributor?"bg-rose-200 text-rose-700":"bg-sky-200 text-sky-700"),children:"joy"===n.contributor?"J":"S"});return(0,a.jsxs)("div",{className:"min-w-[260px] max-w-[320px]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[i,(0,a.jsx)("h3",{className:"font-semibold",children:s?"\uD83D\uDD12 Secret memory":n.title})]}),(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded-full",style:{background:"".concat(T.pG[n.category],"30"),color:"#111"},children:T.Hs[n.category]})]}),(0,a.jsxs)("div",{className:"text-xs text-slate-500 mb-2",children:[null!==(t=n.emoji)&&void 0!==t?t:""," ",n.date,n.time?" \xb7 ".concat(n.time.slice(0,5)):"",n.mood?" \xb7 ".concat(n.mood):""]}),s?(0,a.jsxs)("div",{className:"text-sm",children:["Unlocks on ",n.secret_unlock_date,"."]}):(0,a.jsxs)(a.Fragment,{children:[n.photo_url?(0,a.jsx)("img",{src:n.photo_url,alt:n.title,className:"rounded-xl mb-2 max-h-44 w-full object-cover shadow",onError:e=>{e.target.style.display="none"}}):null,(0,a.jsx)("p",{className:"whitespace-pre-wrap text-sm",children:n.description})]}),(0,a.jsxs)("div",{className:"mt-3 flex items-center justify-between",children:["bucket_list"===n.category?(0,a.jsx)(F,{checked:n.is_bucket_list_completed,onChange:async e=>{await r(n.id,{is_bucket_list_completed:e})}}):(0,a.jsx)("div",{}),(0,a.jsxs)("div",{className:"flex gap-2 text-sm",children:[(0,a.jsx)("button",{className:"btn-soft",onClick:()=>l(n),children:"Edit"}),(0,a.jsx)("button",{className:"btn-soft text-rose-700 dark:text-rose-300",onClick:()=>o(n.id),children:"Delete"})]})]})]})}function I(){let{flyTo:e}=(0,z.q)(),[t,n]=(0,o.useState)(""),[l,r]=(0,o.useState)(!1),[s,i]=(0,o.useState)([]),[c,u]=(0,o.useState)(!1),d=(0,o.useRef)(null),m=(0,o.useRef)(null);(0,o.useEffect)(()=>{let e=e=>{m.current&&!m.current.contains(e.target)&&u(!1)};return window.addEventListener("click",e),()=>window.removeEventListener("click",e)},[]),(0,o.useEffect)(()=>{if(t.trim().length<2){i([]);return}console.log("[SearchBar] query:",t),r(!0),u(!0),d.current&&d.current.abort();let e=new AbortController;d.current=e;let n=setTimeout(async()=>{try{let n="https://nominatim.openstreetmap.org/search?format=json&q=".concat(encodeURIComponent(t),"&addressdetails=0&limit=6"),l=await fetch(n,{signal:e.signal,headers:{Accept:"application/json"}}),r=await l.json();console.log("[SearchBar] results:",r),i(r)}catch(e){console.warn("[SearchBar] fetch aborted or failed")}finally{r(!1)}},300);return()=>clearTimeout(n)},[t]);let p=t=>{u(!1),n(t.display_name);let l=parseFloat(t.lat),r=parseFloat(t.lon);console.log("[SearchBar] go ->",{lat:l,lon:r}),e(l,r,12)};return(0,a.jsxs)("div",{ref:m,className:"relative w-[260px] sm:w-[320px]",children:[(0,a.jsx)("input",{value:t,onChange:e=>n(e.target.value),onFocus:()=>{s.length&&u(!0)},className:"input",placeholder:"Search places...","aria-label":"Search places"}),l?(0,a.jsx)("div",{className:"absolute right-3 top-2.5 text-xs text-slate-500",children:"…"}):null,c&&s.length?(0,a.jsx)("div",{className:"absolute z-[1200] mt-2 w-full romantic-card p-1 max-h-64 overflow-auto animate-pop",children:s.map(e=>(0,a.jsxs)("button",{className:"w-full text-left px-3 py-2 rounded-lg hover:bg-white/70 dark:hover:bg-white/10 transition hover-elevate",onClick:()=>p(e),children:[(0,a.jsx)("div",{className:"text-sm",children:e.display_name}),(0,a.jsxs)("div",{className:"text-xs text-slate-500",children:["(",e.lat,", ",e.lon,")"]})]},e.place_id))}):null]})}function B(e){let{points:t}=e,l=d(),r=(0,o.useRef)(null);return(0,o.useEffect)(()=>(r.current&&(l.removeLayer(r.current),r.current=null),(async()=>{if(!t.length)return;try{await n.e(684).then(n.t.bind(n,6684,23))}catch(e){await n.e(684).then(n.t.bind(n,6684,23))}let e=f().heatLayer(t,{radius:20,blur:15,maxZoom:7,gradient:{.2:"#7cd4ff",.5:"#60a5fa",.8:"#3b82f6"}});e.addTo(l),r.current=e})(),()=>{r.current&&l.removeLayer(r.current)}),[l,t]),null}function H(e){let{onContextMenu:t}=e,n=m({contextmenu(e){t(e)}});return(0,o.useEffect)(()=>{let e=n.getContainer(),t=e=>e.preventDefault();return e.addEventListener("contextmenu",t),()=>e.removeEventListener("contextmenu",t)},[n]),null}function U(e){let{onClick:t}=e;return m({click(e){t(e)}}),null}function Z(){let e=d(),t=(0,z.q)(e=>e.pendingFlyTo);return(0,o.useEffect)(()=>{if(!t)return;console.log("[FlyToController] pendingFlyTo received",t);let{lat:n,lng:l,zoom:r}=t;e.invalidateSize(!0),e.setView([n,l],null!=r?r:16,{animate:!0}),console.log("[FlyToController] setView called",{center:[n,l],zoom:r}),e.once("moveend",()=>{console.log("[FlyToController] moveend center",e.getCenter(),"zoom",e.getZoom()),e.getZoom()<(null!=r?r:16)&&e.setZoom(null!=r?r:16,{animate:!1}),e.panBy([1,1],{animate:!1}),e.panBy([-1,-1],{animate:!1})});let a=f().circleMarker([n,l],{radius:10,color:"#ff80b5",fillColor:"#ff80b5",fillOpacity:.7}).addTo(e);setTimeout(()=>{try{e.removeLayer(a)}catch(e){}},2500),z.q.setState({pendingFlyTo:null})},[t,e]),null}function G(){let e=d(),[t,n]=o.useState({lat:0,lng:0,z:0});return(0,o.useEffect)(()=>{let t=()=>{let t=e.getCenter();n({lat:Number(t.lat.toFixed(5)),lng:Number(t.lng.toFixed(5)),z:e.getZoom()})};return t(),e.on("move",t),e.on("zoom",t),()=>{e.off("move",t),e.off("zoom",t)}},[e]),(0,a.jsxs)("div",{className:"absolute left-2 bottom-2 text-[11px] px-2 py-1 rounded bg-black/40 text-white pointer-events-none",children:[t.lat,", ",t.lng," \xb7 z",t.z]})}function A(){let{getFilteredMemories:e,showTrails:t,showThoughtHeatmap:n,selectedMemoryId:l,setSelectedMemoryId:r,pendingFlyTo:s,initialCenter:i,initialZoom:c,mapVersion:u}=(0,z.q)(),d=e(),[m,p]=(0,o.useState)(!1),[x,v]=(0,o.useState)(null),[g,b]=(0,o.useState)(null),j=(0,o.useRef)(new Map),[y,w]=(0,o.useState)(!0),[N,C]=(0,o.useState)(!1),[k,R]=(0,o.useState)(null),O=(0,o.useCallback)(e=>{b(null),v({lat:e.latlng.lat,lng:e.latlng.lng}),p(!0)},[]),M=(0,o.useMemo)(()=>d.filter(e=>"thought"===e.category).map(e=>[e.lat,e.lng,.5]),[d]),F=(0,o.useMemo)(()=>t?d.slice().sort((e,t)=>{var n,l;return new Date("".concat(e.date," ").concat(null!==(n=e.time)&&void 0!==n?n:"00:00:00")).getTime()-new Date("".concat(t.date," ").concat(null!==(l=t.time)&&void 0!==l?l:"00:00:00")).getTime()}).map(e=>[e.lat,e.lng]):[],[d,t]),A=(0,o.useRef)(null);return(0,o.useEffect)(()=>{if(!l||!A.current)return;let e=d.find(e=>e.id===l);e&&(console.log("[MapView] selectedMemoryId flyTo",e),A.current.flyTo([e.lat,e.lng],8,{duration:1.2}),setTimeout(()=>{let t=j.current.get(e.id);t&&t.openPopup(),r(null)},800))},[l,d,r]),(0,a.jsxs)("div",{className:"relative h-full min-h-[560px]",children:[(0,a.jsxs)(h,{ref:A,className:"map-frame w-full h-full animate-rise",center:[i.lat,i.lng],zoom:c,children:[(0,a.jsx)(_,{attribution:"\xa9 OpenStreetMap",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,a.jsx)(H,{onContextMenu:e=>{b(null),v({lat:e.latlng.lat,lng:e.latlng.lng}),p(!0)}}),(0,a.jsx)(U,{onClick:O}),(0,a.jsx)(Z,{}),(0,a.jsx)(G,{}),n?(0,a.jsx)(B,{points:M}):null,d.map(e=>{let t="secret"===e.category&&e.secret_unlock_date&&new Date(e.secret_unlock_date)>new Date,l=T.pG[e.category]||e.color||"#888",r="bucket_list"===e.category&&e.is_bucket_list_completed?"#22c55e":l,o=n&&"thought"===e.category?.25:.9;return(0,a.jsxs)(S,{ref:t=>{t?j.current.set(e.id,t):j.current.delete(e.id)},center:[e.lat,e.lng],pathOptions:{color:r,fillColor:r,fillOpacity:.7},radius:8,opacity:o,children:[(0,a.jsxs)(E,{direction:"top",offset:[0,-8],children:[t?"\uD83D\uDD12 Secret memory":"".concat(e.title)," \xb7 ",e.date," \xb7 ","joy"===e.contributor?"Joy":"Socrates"]}),(0,a.jsx)(L,{maxWidth:320,children:(0,a.jsx)(q,{memory:e,onEdit:e=>{b(e),v({lat:e.lat,lng:e.lng}),p(!0)}})})]},e.id)}),t&&F.length>1?(0,a.jsx)(D,{positions:F,pathOptions:{color:"#94a3b8",opacity:.5,weight:3}}):null]},u),(0,a.jsx)("div",{className:"absolute right-3 top-3 z-[1100] w-[260px] sm:w-[320px] animate-pop",children:(0,a.jsx)("div",{className:"rounded-2xl border border-white/60 bg-white/70 shadow-[0_10px_35px_-20px_rgba(255,128,181,0.9)]",children:(0,a.jsx)(I,{})})}),y?(0,a.jsxs)("div",{className:"absolute left-16 top-3 bg-white/90 dark:bg-slate-900/90 border border-white/30 rounded-xl px-3 py-2 text-sm shadow-soft",children:["Tap the map to add a memory.",(0,a.jsx)("button",{className:"ml-2 text-slate-500 hover:text-slate-700",onClick:()=>w(!1),children:"Dismiss"})]}):null,(0,a.jsx)("div",{className:"absolute bottom-4 right-4 z-[1001] rounded-full w-14 h-14 flex items-center justify-center bg-gradient-to-br from-core to-pink-500 text-white text-2xl shadow-[0_10px_30px_-10px_rgba(255,128,181,0.8)] cursor-grab active:cursor-grabbing select-none pointer-events-auto animate-float hover-elevate",onPointerDown:e=>{var t;e.preventDefault(),C(!0),R({x:e.clientX,y:e.clientY}),null===(t=A.current)||void 0===t||t.dragging.disable();let n=e=>{R({x:e.clientX,y:e.clientY})},l=e=>{var t;window.removeEventListener("pointermove",n),window.removeEventListener("pointerup",l),C(!1),null===(t=A.current)||void 0===t||t.dragging.enable();let r=A.current;if(!r)return;let a=r.getContainer().getBoundingClientRect(),o=e.clientX-a.left,s=e.clientY-a.top;if(o>=0&&s>=0&&o<=a.width&&s<=a.height){let e=r.containerPointToLatLng(f().point(o,s));b(null),v({lat:e.lat,lng:e.lng}),p(!0)}};window.addEventListener("pointermove",n),window.addEventListener("pointerup",l)},onClick:()=>{var e;let t=null===(e=A.current)||void 0===e?void 0:e.getCenter();t&&(b(null),v({lat:t.lat,lng:t.lng}),p(!0))},title:"Drag onto the map to add a memory","aria-label":"Drag to add memory",children:"❤️"}),N&&k?(0,a.jsx)("div",{className:"fixed pointer-events-none z-[1002]",style:{left:k.x-16,top:k.y-16},children:(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-core/90 text-white text-xl flex items-center justify-center shadow-lg",children:"❤️"})}):null,(0,a.jsx)(P,{open:m,onClose:()=>p(!1),initialLatLng:x,editing:g})]})}}}]);